---
title: "TIL_191110"
date: "2019.11.10"
template: "post"
draft: false
slug: "/posts/til_191110/"
category: "TIL"
tags:
  - "Project"
  - "Mongo DB"
  - "node.js"
  - "express"
description: "Things I've learned through project"
socialImage: ""
---

프로젝트를 마무리하면서, 내가 만들었던 페이지에 대한 endpoint를 node.js로 간략하게 만들어보았다.

기존의 웹 사이트는 `회원가입 -> 그룹 생성 -> 이벤트 생성` 이라는 조금 복잡한 절차를 필요로 하지만, 내가 만들었던 페이지는 '이벤트 생성'과 그 이벤트에 대한 '상세 페이지'이므로 그룹에 관련한 부분은 생략했다.

**1. 서버 생성**  
node.js는 굉장히 express를 통해 (이름 그대로) 빠른 속도로 서버를 생성할 수 있다.

```js
const http = require("http");
const app = require("./app");

const port = process.env.PORT || 3000;

const server = http.createServer(app);

server.listen(port, null, () => {
  console.log("listening to " + port);
});
```

express에 있는 http 모듈을 사용하면 `http.createServer()`만으로 서버를 생성할 수 있다.

port에 관해서, 3000은 `localhost:3000`을 이용한다는 말이다.

`process.env.PORT`는 환경 변수에서 설정한 PORT를 사용하겠다는 말이다.

`dotenv`라는 라이브러리를 사용해서 `.env` 파일을 생성하고 `PORT = 3030`라고 선언하면 된다. 추가적으로 MONGODB_URI나 API_KEY 같은 것들을 선언해 사용할 수 있다. 그리고 git에 업로드할 경우, 반드시 `gitignore`에 `.env`를 추가해 노출을 막아야 한다.

**2. 모델링**  
 **Users**

```js
const mongoose = require("mongoose");
const Schema = mongoose.Schema;
const userSchema = new Schema({
  _id: Schema.Types.ObjectId,
  username: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  image: { type: String },
  group: { type: String },
  host: { type: Schema.Types.ObjectId, ref: "Events" },
  eventsAttend: [{ type: Schema.Types.ObjectId, ref: "Events" }]
});
```

mongoose는 Schema를 이용해 schema를 손쉽게 만들 수 있다.

type과 기타 옵션은 공식 문서에 잘 나와있다.

Mongo DB는 No sql 이기 때문에 데이터 테이블 간의 관계에서 자유롭지만, ref를 통해 서로 관계를 설정해주는 것은 가능하다.

후에 populate로 해당 도큐멘트를 모두 불러올 수 있다.

**Events**

```js
const eventSchema = new Schema({
  _id: Schema.Types.ObjectId,
  name: { type: String, required: true },
  mainImage: { type: String },
  introduction: { type: String, required: true },
  findGroup: { type: String, required: true },
  lat: { type: Number },
  lng: { type: Number },
  startDate: { type: Date, required: true },
  endDate: { type: Date, required: true },
  limitUser: { type: Number, required: true },
  host: { type: Schema.Types.ObjectId, ref: "Users" },
  attenddees: [{ type: Schema.Types.ObjectId, ref: "Users" }],
  createdAt: { type: Date, default: Date.now() },
  address: { first: String, second: String }
});
```

mongoose에서 자체적으로 지원하는 created, updated date option이 있다.

이번에는 `Date`이라는 type을 이용해 `default: Date.now()`, 그러니까 기본값으로 도큐멘트가 생성되는 시점을 적용했다.

이벤트는 주최자, 참여자 모두 Users 도큐멘트와 상관 관계가 있는데, 주최자는 한명이지만 참여자는 여럿이므로  
`attenddees: [{ type: Schema.Types.ObjectId, ref: "Users" }]`
배열 안의 하나의 User 도큐멘트가 존재하도록 했다.
