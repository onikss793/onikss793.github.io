---
title: "TIL_191125"
date: "2019.11.25"
template: "post"
draft: false
slug: "/posts/til_191125/"
category: "TIL"
tags:
  - "Promise"
  - "async"
  - "await"
description: "Promise, async and await"
socialImage: ""
---

1. 자바스크립트는 싱글 스레드로 작동한다. 싱글 스레드란 자바 스크립트를 실행하는 일종의 통로를 말한다. 통로가 하나이기 때문에 한번에 하나의 일만 처리할 수 있다.

2. 자바스크립트는 비동기 연산이 가능하다. 비동기 연산이란 하나의 실행 컨텍스트 안에서 동기로 처리되지 않고, 따로 처리하는 것을 말한다.

3. Promise란 이때 발생하는 것으로, 비동기 작업이 맞이할 미래의 완료 값 혹은 실패 값을 나타낸다.

4. Promise는 두 가지 인자를 받는다. `(resolved, rejected)` 각각 성공했을 때, 실패했을 때에 처리할 함수를 나타낸다.

5. Promise의 작동 순서는 다음과 같다.

   - 자바스크립트가 실행 컨텍스트에 콜스텍을 쌓다가 비동기 함수를 만나면 이벤트 루프에 던져놓고, promise를 받는다.
   - 동기로 처리할 일들을 마친 후, promise를 확인한다.
   - 완료 값이 나올 경우, resolved를 실행한다. 실패 했을 경우, rejected를 실행한다.

6. 보통 두 개 이상의 비동기 작업을 수행해야 할 경우 이전 단계의 비동기 작업이 완료된 뒤 다음 비동기 작업을 수행해야 하는 경우가 생긴다.

7. 이런 상황에서 `.then()` 을 이용해 chaining하면 된다.

   ```js
   const promise = doSomethingAsync();
   const promise2 = doSomethingAsync().then(
     whenSuccessCallme,
     whenFailedCallme
   );
   ```

8. 위의 방식을 사용해 편리하게 promise를 처리할 수 있다. 그러나 비동기에 대한 비동기 작업이 생기면 생길 수록, 콜백 지옥에 빠질 수 있다.

9. `async/await`를 활용하면 이러한 콜백 지옥에서 쉽게 나올 수 있다.

   ```js
   function printData(url) {
     return showData(url)
       .then(result => console.log(result))
       .catch(err => console.log(err));
   }
   ```

   위와 같은 함수를 async/await를 사용하면 아래와 같이 바꿀 수 있다.

   ```js
   async function printData(url) {
     try {
       let result = await showData(url);
       console.log(result);
     } catch (err) {
       console.log(err);
     }
   }
   ```

`then().catch()`보다 훨씬 직관적으로 알아 볼 수 있으며, 코드가 깊어질 일도 상대적으로 적다.

10. async는 함수를 비동기로 실행하겠다는 일종의 선언이다. await는 비동기 함수가 반환하는 Promise 객체를 기다렸다가 결과 값을 받아주겠다는 의미이다. await를 사용하면 Promise가 결과값으로 풀어질 때까지 다음 코드들도 실행되지 않고 기다리게 된다.

11. `Promise.all()` 과 `Promise.all()`은 비동기 작업을 병렬로 실행하기 위한 구성 도구이다.

    ```js
    Promise.all(array.map(el => {
      return await asyncFunction(el);
    }))
    ```

    위처럼 반복문에서 Promise 객체를 반환해야 하는 경우 `Promise.all()`은 모든 Promise를 기다렸다가 Promise를 반환해준다. 주의할 것은 `Promise.all()`도 Promise를 반환하기 때문에 해당 함수에서 return 시에 await를 사용하거나, 해당 함수를 호출하는 곳에서 await로 받아야 한다.
