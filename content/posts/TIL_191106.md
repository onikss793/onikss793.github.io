---
title: "TIL_191106"
date: "2019.11.06"
template: "post"
draft: false
slug: "/posts/til_191106/"
category: "TIL"
tags:
  - "Project"
  - "Social Login"
description: "Things I've learned through project"
socialImage: ""
---

## **Social Login**

예를 들어, 카카오 소셜 로그인을 사용하면 카카오에서 제공하는 유저 정보만을 이용해 유저 데이터를 구성하는 것이다.

1. 카카오로 로그인 클릭(request)
2. 카카오에서 만든 토큰을 제공(response)
3. 받은 토큰을 그대로 백앤드 서버로 전송(request)
4. 백앤드 서버에서 카카오 (유저확인)api를 호출(request)
5. 토큰을 받은 카카오 서버가 유저 정보를 제공한다(비밀번호 제외)(response)
6. 아이디와 기타 유저 정보(id, phone number, etc)를 받은 후 그 정보를 기반으로 데이터 베이스에 존재 유무를 확인한다(buisiness logic)
   - 없을 시: 회원가입(새로운 열을 생성)
   - 있을 시: 로그인(토큰을 만들어 프론트 서버에 전송)(response)
7. 로그인을 했다면 백앤드 서버에서 받은 토큰을 받아 저장한다.(response)

### **email 인증**

1. 이메일 보내는 라이브러리를 사용해서 회원가입 때 받은 이메일을 활용해 이메일을 보낸다.(무슨 이메일?=> 2,3번)
2. 인증할 때 필요한 html을 프론트가 만들어서 백앤드에 전송한다.
3. 백앤드에서 그 html을 담아서 이메일을 보낸다.
   ex) <a href="aasldfaj/token=a;sldkfj"> 쿼리 스트링으로 전송.
4. 프론트 앤드에서 쿼리 스트링을 확인해서 이메일을 인증하는 앤드 포인트를 호출, 가입한 사람이라면 유저를 활성화 시킨다.

### **페이지네이션**

스크롤 내리면 추가적으로 로딩이 되는 효과

1. 최초의 get 요청을 통해 1 ~ 10을 받는다.
2. 일정 조건을 만족하면 다시 get 요청을 보낸다 쿼리 스트링에 담아서 전송(offset = 11)(state로 현재 몇개를 받았는지 관리하고 있어야 한다)
3. 11 ~ 20을 받는다.

### **iampay 이용해서 결제 api 호출하기**

```js
pay = () => {
  const { name, amount, tel } = this.state;
    window.IMP.request_pay(
      {
        name: "이벤트 회비",
        merchant_uid: "merchant_" + new Date().getTime(),
        amount: amount,
        buyer_email: name,
        buyer_tel: tel
      },
      function(rsp) {
        console.log(rsp);
        if (rsp.success) {
          let msg = "결제가 완료되었습니다.";
          msg += "고유ID : " + rsp.imp_uid;
          msg += "상점 거래ID : " + rsp.merchant_uid;
          msg += "결제 금액 : " + rsp.paid_amount;
          msg += "카드 승인번호 : " + rsp.apply_num;
        } else {
          let msg = "결제에 실패하였습니다.";
          msg += "에러내용 : " + rsp.error_msg;
        }
      }
    );
  } else {
    const { wrongInfo } = this.state;
    this.setState({ wrongInfo: true });
  }
};
```

1. 먼저 IMP.init이라는 메서드를 호출해야 한다. 전역에 단 한번만 호출되면 되기 때문에 따로 빼서 호출해주었다.
2. pay라는 메서드를 만들어서 request_pay라는 메서드를 호출한다.
3. 해당 메서드 안에는 첫번째 인자로 객체가 들어가는데 필수적으로 어떤 키 값이 들어가야 하는지는 공식 문서를 확인하면 알 수 있다.
4. 두번째 인자로 콜백 함수를 넣을 수 있다.
5. 해당 함수에서는 응답을 통해 결제 진행 여부, 에러를 파악할 수 있다.
