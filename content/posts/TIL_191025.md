---
title: "TIL 191025"
date: "2019.10.25"
template: "post"
draft: false
slug: "/posts/til_191025/"
category: "TIL"
tags:
  - "TIL"
  - "Django"
  - "React Native"
description: "What I learned today"
socialImage: ""
---

#### **Authentification**

Authentification이란 요청을 보내는 사용자를 신뢰할 수 있는지, 그 권한 여부를 판단하는 메커니즘을 이야기한다.

django는 기본적으로 django.auth를 제공한다. 하지만 그 원리를 조금 더 익혀보고자 bcrypt와 jwt를 이용해 인증과 인가를 연습해보려 한다.

우선 View에서 bcrypt와 jwt를 사용하려면 install을 먼저 해주어야 한다.

```py
pip install bcrypt
pip install jwt
```

위 명령어를 이용하면 설치할 수 있다. 참고로 프로젝트의 가상환경 내에서 설치해야 한다는 것을 잊지 말아야 한다.

**회원가입**

기본적인 회원가입에 필요한 데이터 중, 비밀번호는 반드시 암호화해서 데이터베이스에 저장되어야 한다. 먼저 받은 비밀번호를 byte로 인코딩한다. byte로 인코딩된 값은 `b'sss` 로 표시된다.

```py
byte_pw       = bytes(signup_data["password"])
```

그리고 byte된 비밀번호를 hashing 한다.

```py
hashed_pw     = bcrypt.hashpw(byte_pw, bcrypt.gensalt())
```

까먹지 안아야 하는 점은 데이터 베이스에 저장할 때는 디코딩('utf-8')해서 저장한다는 점이다.

```py
Users(
      name      = signup_data["name"],
      user_name = signup_data["user_name"],
      password  = hashed_pw.decode("utf-8")
).save()
```

**로그인**

로그인을 할 때는 bcrypt에 있는 checkpw()라는 메서드를 사용한다. 인자로는 `checkpw(입력한 비밀번호, db에 있는 비밀번호)` 이렇게 받는데 주의할 점은 입력한 비밀번호, db에 있는 비밀번호 모두 'utf-8' 방식으로 인코딩해야 한다는 것이다.

```py
try:
    user = Users.objects.get(user_name=login_data["user_name"])
    if bcrypt.checkpw(password.encode("utf-8"), user.password.encode("utf-8")):
```

위처럼 checkpw 메서드의 인자는 반드시 인코딩한 값이 들어가야 한다.
비밀번호가 일치했다면 프론트앤드 서버로 웹토큰을 발행해주어야 한다.

```py
    payload           = {"user_id": user.id, "exp":"Oct 25 2019 18:29:52 GMT+0900"}
    encryption_secret = "secret"
    algorithm         = "HS256"
    encoded           = jwt.encode(payload, encryption_secret, algorithm=algorithm)
```

jwt를 사용하면 Base64URL로 인코딩을 할 수 있다. 위의 내용을 이해하기 위해서는 먼저 jwt의 구조를 알아야 한다.  
각각은 . 으로 구분되어 있다. 먼저 1번으로 header가 있다. `{ "typ":"JWT", "alg":"HS256" }` 이와 같은 형태로 Token type(JWT), 해시알고리즘을 담고 있다.  
2번으로 payload, 사용자 정보(중요한 정보, 사용자 이름 등은 절대로 담으면 안 된다)가 담겨 있다.  
3번째로 signature, JWT가 원본 그대로라는 것을 확인할 때 사용되는 부분으로써, header, payload 그리고 secret key가 해싱되어 있다.

jwt.encode에는 총 3개의 인자를 받을 수 있는데 첫번째는 payload, 즉 담을 내용을 말한다. user.id를 넣을 수 있다. 두번째는 encryption_secret, 다시 말해 암호화할 secret key를 말한다. 세번째로 암호화할 때 사용할 알고리즘을 지정한다. 로그인 후, 프론트엔드 서버와 토큰을 주고 받으며 통신하는 부분은 다음 편에 이어서 적도록 하겠다.

### **React Native Navigation**

Drawer Navigation 왼쪽에 navigation 바가 생긴다. (옷장 문여는 것 같아서 생긴 이름인 것 같다).

bottomTabNavigation 화면 하단에 navigation 바가 생긴다.

```js
HomeStack.navigationOptions = {
  tabBarLabel: "Home",
  tabBarIcon: ({ focused }) => (
    <TabBarIcon
      focused={focused}
      name={
        Platform.OS === "ios"
          ? `ios-information-circle${focused ? "" : "-outline"}`
          : "md-information-circle"
      }
    />
  )
};
```

`` `ios-information-circle${focused ? '' : '-outline'}` `` => React Native에서 제공하는 기본적인 icon들이 있는데(expo vetor icons) 이것들을 이름만 바꾸면 이용할 수 있다.
